$(function() {
    function u() {
        $("#chart-details").highcharts({
            chart: {
                marginRight: 30
            },
            annotationsOptions: {
                buttons: []
            },
            title: {
                useHTML: !0,
                align: "left",
                y: 0,
                text: '<div style="width:400px; text-align: center; background-color: #f2f2f2; font-size:14px; padding:10px 0px 5px 0px;">Zoom view</div>'
            },
            yAxis: {
                lineWidth: 1,
                lineColor: "#696969",
                gridLineColor: "#e6e6e6",
                minRange: 100,
                title: {
                    text: null
                }
            },
            xAxis: {
                lineWidth: 1,
                lineColor: "#696969",
                gridLineColor: "#e6e6e6",
                type: "datetime"
            },
            credits: {
                enabled: !1
            },
            legend: {
                enabled: !1
            },
            tooltip: {
                enabled: !1
            },
            plotOptions: {
                series: {
                    states: {
                        hover: {
                            halo: {
                                size: 0
                            }
                        }
                    },
                    cursor: "ns-resize",
                    point: {
                        events: {
                            drag: function(c) {
                                var d = this.series.chart,
                                    a = this.series,
                                    b = $("#chart").highcharts().series[0];
                                b.xData.indexOf(c.newX);
                                c = b.chart.getSelectedPoints();
                                c = c[c.length - 1];
                                var d = b.processedXData.indexOf(d.pointToSelect.x),
                                    m;
                                0 <= d && c && (d = 3 * (d + 1) - 1, m = a.yData.reduce(function(a, b) {
                                    return a + b
                                }), a = m / a.yData.length, a = b.yAxis.toPixels(a) - b.chart.plotTop, c.graphic && (0 < a && a < b.yAxis.height ? (c.graphic.translate(0,
                                    a - c.plotY), c.graphic.show()) : c.graphic.hide()), b.graphPath[d] = a, b.graph.attr({
                                    d: b.graphPath
                                }))
                            },
                            drop: function(c) {
                                var d = this.series.chart;
                                c = c.target;
                                var a = $("#chart").highcharts().series[0],
                                    b = a.xData.indexOf(c.x),
                                    d = a.processedXData.indexOf(d.pointToSelect.x);
                                0 <= b && (a.options.data[b][1] = c.y, a.isDirty = a.isDirtyData = chart.isDirtyBox = !0, a.options.data[b][1] > a.options.data[b][2] ? a.options.data[b][2] = a.options.data[b][1] : a.options.data[b][1] < a.options.data[b][3] && (a.options.data[b][3] = a.options.data[b][1]),
                                    a.setData(a.options.data, !0, !0), 0 <= d && a.points[d].select(!0))
                            }
                        }
                    },
                    stickyTracking: !1
                }
            },
            series: [{
                draggableY: !0,
                data: []
            }]
        }, v)
    }

    function v(c) {
        var d = $("#chart-details");
        c = d.find(".highcharts-title");
        var a = $("#chart").highcharts(),
            b = Math.round(a.series[0].points.length / 2),
            m = !1,
            l, g;
        c.mousedown(function(a) {
            var b = d.offset();
            m = !0;
            l = a.pageX - b.left;
            g = a.pageY - b.top
        });
        $(document).mousemove(function(a) {
            m && d.css({
                top: a.pageY - g + "px",
                left: a.pageX - l + "px"
            })
        });
        $(document).mouseup(function(a) {
            m = !1
        });
        a.series[0].points[b].firePointEvent("click");
        a.tooltip.refresh(a.series[0].points[b]);
        a.series[0].setData(a.series[0].options.data, !0, !1)
    }

    function x(c, d) {
        var a = this;
        this.tooltip = $(c);
        this.actual = this.tooltip.find(".tooltip-actual");
        this.max = this.tooltip.find(".tooltip-max");
        this.content = this.tooltip.find(".tooltip-content");
        this.nextButton = this.tooltip.find(".tooltip-next");
        this.prevButton = this.tooltip.find(".tooltip-prev");
        this.endButton = this.tooltip.find(".tooltip-end");
        this.masks = [$("#tooltip-mask-top"), $("#tooltip-mask-right"), $("#tooltip-mask-bottom"),
            $("#tooltip-mask-left"), $("#tooltip-mask-center")
        ];
        this.messages = d;
        this.arrow = $("#tooltip .diamond");
        this.messagesLength = this.messages.length;
        this.index = 0;
        a.start = function() {
            a.prevButton.click(a.prev).hide();
            a.nextButton.click(a.next);
            a.endButton.click(a.stop);
            a.tooltip.find(".tooltip-close").click(a.stop);
            a.tooltip.find(".tooltip-max").text(a.messagesLength);
            a.allowReflow = !0;
            a.show();
            return a
        };
        a.next = function() {
            a.index < a.messagesLength - 1 && (a.index++, a.show(!0));
            return a
        };
        a.prev = function() {
            0 < a.index &&
                (a.index--, a.show(!0));
            return a
        };
        a.stop = function() {
            a.tooltip.fadeOut();
            a.allowReflow = !1;
            $.each(a.masks, function(a, c) {
                c.fadeOut()
            });
            return a
        };
        a.show = function(b) {
            b = a.messages[a.index];
            var c = $(b.relativeTo),
                d = c.offset(),
                g = d.top + 20,
                f = b.pane.padding,
                w = b.offset ? b.offset.top : 0,
                e = b.pane.marginTop || 0,
                h = b.pane.marginLeft || 0,
                k = b.pane.boxWidth || 200;
            d.left += b.pane.offsetLeft || 0;
            a.tooltip.width(k);
            a.masks[0].css({
                width: b.pane.width + 2 * f + "px",
                height: g - 20 - f + e + "px",
                left: d.left - f - 5 + "px"
            });
            a.masks[1].css({
                left: d.left +
                    b.pane.width + f - 5 + "px"
            });
            a.masks[2].css({
                width: b.pane.width + 2 * f + "px",
                top: g + b.pane.height - f - 20 + "px",
                left: d.left - f - 5 + "px"
            });
            a.masks[3].css({
                width: d.left - f - 5 + "px"
            });
            a.masks[4].css({
                width: b.pane.width + 2 * f + "px",
                height: b.pane.height - e + "px",
                top: g - f - 20 + e + "px",
                left: d.left - f - 5 + "px"
            });
            $.each(a.masks, function(a, b) {
                b.show()
            });
            0 === a.index ? a.prevButton.hide() : a.prevButton.show();
            a.index == a.messagesLength - 1 ? (a.nextButton.hide(), a.prevButton.hide(), a.endButton.show()) : (a.nextButton.show(), a.prevButton.show(), a.endButton.hide());
            a.content.html(b.text);
            a.actual.text(a.index + 1);
            "left" == b.arrowPosition ? (a.tooltip.css({
                left: d.left + b.pane.width + f + 7 + h + "px",
                top: g + w + "px"
            }), a.arrow.css({
                left: "-7px",
                top: a.tooltip.height() / 2 - 7 + "px"
            }).show()) : "top" == b.arrowPosition ? (a.tooltip.css({
                left: h + d.left - f - 13 - (a.tooltip.width() - b.pane.width - 20) / 2 + "px",
                top: g + f + 15 + "px"
            }), a.arrow.css({
                left: a.tooltip.width() / 2 - 7 + "px",
                top: "-7px"
            }).show()) : (a.tooltip.css({
                left: h + c.width() * parseFloat(b.pane.left) / 100 + "px",
                top: "45%"
            }), a.arrow.hide());
            a.tooltip.show();
            return a
        };
        a.reflow = function() {
            a.show(!1)
        };
        return this
    }

    function p() {
        var c = $(".highcharts-button:eq(8)").offset(),
            d = $("#menu-nav"),
            a = d.width();
        d.css({
            top: c.top,
            left: c.left - a - 14,
            display: "block"
        });
        n && n.allowReflow && n.reflow()
    }
    console.info("See email.");
    Highcharts.Tooltip.prototype.hide = function() {};
    Highcharts.theme = {
        yAxis: {
            lineWidth: 1,
            lineColor: "#696969",
            gridLineColor: "#e6e6e6"
        },
        navigator: {
            yAxis: {
                lineColor: "#b2b1b6"
            }
        },
        xAxis: {
            lineWidth: 1,
            lineColor: "#696969",
            tickLength: 5,
            tickColor: "#696969",
            gridLineColor: "#e6e6e6",
            gridLineWidth: 1
        }
    };
    Highcharts.setOptions(Highcharts.theme);
    var n, y = $("#highcharts-indicators"),
        h = $("#highcharts-edit-annotation"),
        q = $("#highcharts-change-fill"),
        r = $("#highcharts-change-border"),
        t = $("#highcharts-change-title"),
        e = {
            showTooltip: !1,
            addEvents: !0,
            chart: {
                panning: !1,
                borderWidth: 5,
                borderColor: "#e8eaeb",
                borderRadius: 0,
                backgroundColor: "#f2f2f2",
                height: $(window).height(),
                events: {
                    load: function() {
                        function c() {
                            var a = this.value,
                                b = -1,
                                c = $("#chart").highcharts();
                            $.each(c.indicators.allItems, function(c,
                                d) {
                                d.options.type == a && (b = c)
                            }); - 1 == b && c.addIndicator({
                                id: "AAPL",
                                type: a,
                                styles: {
                                    "stroke-width": 1,
                                    dashstyle: "solid"
                                }
                            })
                        }
                        p();
                        if (this.options.addEvents) {
                            u(this);
                            y.change(c);
                            var d = $("#highcharts-restart-tutorial").click(function() {
                                $("#hello-msg-box").show();
                                $("#tooltip-mask-top").css({
                                    height: "100%",
                                    left: 0,
                                    width: "100%"
                                }).show()
                            });
                            this.options.showTooltip && d.click();
                            $("#highcharts-save").click(function() {
                                var a = $("#chart").highcharts(),
                                    b = [],
                                    c = [];
                                $.each(a.indicators.allItems, function(a, b) {
                                    c.push({
                                        id: b.options.id,
                                        type: b.options.type,
                                        params: b.options.params,
                                        styles: b.options.styles,
                                        yAxis: b.options.yAxis
                                    })
                                });
                                $.each(a.annotations.allItems, function(a, c) {
                                    b.push(c.options)
                                });
                                window.localStorage.setItem("data", JSON.stringify({
                                    data: a.series[0].options.data,
                                    indicators: c,
                                    annotations: b
                                }))
                            });
                            $("#highcharts-reset").click(function() {
                                var a = $("#chart").highcharts();
                                window.localStorage.removeItem("data");
                                a.showLoading();
                                $.getJSON("http://www.highcharts.com/samples/data/jsonp.php?filename=aapl-ohlcv.json&callback=?", function(b) {
                                    e.series[0].data =
                                        b;
                                    e.showTooltip = !1;
                                    e.addEvents = !1;
                                    e.indicators = [];
                                    e.annotations = [];
                                    a.hideLoading();
                                    $("#chart").highcharts("StockChart", $.extend(!0, {}, e), function(a) {
                                        a.series[0].points[Math.round(a.series[0].points.length / 2)].firePointEvent("click")
                                    })
                                })
                            });
                            $("#highcharts-sources").change(function() {
                                var a = this.value,
                                    b = $("#chart").highcharts();
                                b.showLoading();
                                $("#chart-details").highcharts().series[0].setData([]);
                                $.getJSON("http://www.highcharts.com/samples/data/jsonp.php?filename=" + a + ".json&callback=?", function(c) {
                                    b.series[0].update({
                                        data: c,
                                        name: a.split("-")[0].toUpperCase()
                                    });
                                    b.hideLoading()
                                })
                            });
                            $("#highcharts-change-annotation").click(function() {
                                var a = $("#chart").highcharts(),
                                    b = a.annotationToEdit;
                                b && b.options && (b.options.title && "" !== b.options.title.text ? b.update(Highcharts.merge(b.options, {
                                    title: {
                                        text: t.val()
                                    }
                                })) : b.update(Highcharts.merge(b.options, {
                                    shape: {
                                        params: {
                                            stroke: r.css("background-color"),
                                            fill: q.css("background-color")
                                        }
                                    }
                                })), b.redraw());
                                h.hide();
                                a.annotationToEdit = !1
                            });
                            $(h).find(".cancel").click(function(a) {
                                var b = $("#chart").highcharts(),
                                    c = b.annotationToEdit;
                                c && c.options && c.events.deselect.call(c, a);
                                h.hide();
                                b.annotationToEdit = !1
                            });
                            $("#highcharts-remove-annotation").click(function() {
                                var a = $("#chart").highcharts(),
                                    b = a.annotationToEdit;
                                b && b.options && b.destroy();
                                h.hide();
                                a.annotationToEdit = !1
                            });
                            $("#highcharts-change-fill").ColorPicker({
                                color: "#e7f0f9",
                                livePreview: !0,
                                onShow: function(a) {
                                    $(a).fadeIn(500);
                                    return !1
                                },
                                onHide: function(a) {
                                    $(a).fadeOut(500);
                                    return !1
                                },
                                onChange: function(a, b, c) {
                                    $("#highcharts-change-fill").css("backgroundColor",
                                        "#" + b)
                                }
                            });
                            $("#highcharts-change-border").ColorPicker({
                                color: "#6688aa",
                                livePreview: !0,
                                onShow: function(a) {
                                    $(a).fadeIn(500);
                                    return !1
                                },
                                onHide: function(a) {
                                    $(a).fadeOut(500);
                                    return !1
                                },
                                onChange: function(a, b, c) {
                                    $("#highcharts-change-border").css("backgroundColor", "#" + b)
                                }
                            });
                            $("#hello-msg-box .tooltip-close").click(function() {
                                $("#hello-msg-box").hide();
                                $("#tooltip-mask-top").hide()
                            });
                            $("#hello-msg-box .hello-start-tutorial").click(function() {
                                $("#hello-msg-box").hide();
                                n = (new x("#tooltip", [{
                                    text: '<div class="tooltip-title">Source</div><div class="tooltip-subcontent">We can plug in real-time data stream, CSV files or any other data source, Yahoo finance for example.</div>',
                                    relativeTo: "#highcharts-sources",
                                    arrowPosition: "top",
                                    pane: {
                                        marginTop: -6,
                                        padding: 3,
                                        width: 96,
                                        height: 30
                                    }
                                }, {
                                    text: '<div class="tooltip-title">Save & Reset</div><div class="tooltip-subcontent">We can make the chart save into your database or any other storage so you can get back to it anytime.</div>',
                                    relativeTo: "#highcharts-manage-chart",
                                    arrowPosition: "top",
                                    pane: {
                                        marginTop: -6,
                                        padding: 3,
                                        width: 175,
                                        height: 32
                                    }
                                }, {
                                    text: '<div class="tooltip-title">Indicators</div><div class="tooltip-subcontent">We can prepare special series. For example, they can be drawn based on calculations made using other series.</div>',
                                    relativeTo: "#highcharts-indicators",
                                    arrowPosition: "top",
                                    pane: {
                                        marginTop: -5,
                                        padding: 3,
                                        width: 96,
                                        height: 30
                                    }
                                }, {
                                    text: '<div class="tooltip-title">Annotations</div><div class="tooltip-subcontent">You may be able to add many complex objects to your chart if we install one of our plugins. <span style="color: yellow;">Please use right-click to edit objects</span></div>',
                                    relativeTo: ".highcharts-button:eq(7)",
                                    arrowPosition: "top",
                                    pane: {
                                        marginTop: -5,
                                        offsetLeft: -35,
                                        padding: 3,
                                        width: 139,
                                        height: 32
                                    }
                                }, {
                                    text: '<div class="tooltip-title">Draggable</div><div class="tooltip-subcontent">Many custom and complex features can be added. Using drag and drop method to manipulate data is an example. Please drag one of these points to see real-time changes in a main series.</div>',
                                    relativeTo: "#chart-details",
                                    arrowPosition: "left",
                                    pane: {
                                        offsetLeft: 5,
                                        padding: 15,
                                        height: 278,
                                        width: 400
                                    }
                                }, {
                                    text: '<div class="tooltip-title">Thank you</div><div class="tooltip-subcontent">Now you can play with this chart and try it yourself.</div>',
                                    relativeTo: "body",
                                    arrowPosition: "none",
                                    endButton: !0,
                                    pane: {
                                        left: "50%",
                                        marginLeft: -155,
                                        padding: 0,
                                        height: 0,
                                        width: 0,
                                        boxWidth: "310px"
                                    }
                                }])).start()
                            })
                        }
                    },
                    redraw: function() {
                        if (this.selectedXPoint) {
                            var c = this.series[0],
                                d = c.processedXData,
                                a = c.xData.indexOf(this.selectedXPoint),
                                b = c.processedXData.indexOf(this.selectedXPoint),
                                e = d.length,
                                l = !1;
                            i = 0;
                            if (0 <= a && this.series[0].points[a]) c.points[a].select(!0), l = !0;
                            else if (0 <= b) c.points[b].select(!0), l = !0;
                            else
                                for (; i < e; i++)
                                    if (d[i] > this.selectedXPoint) {
                                        c.points[i].select(!0);
                                        l = !0;
                                        break
                                    }
                            l || c.points[Math.round(e / 2)].select(!0)
                        }
                        setTimeout(p, 10);
                        var g = this.renderer,
                            f = this.plotWidth;
                        Highcharts.each(this.yAxis, function(a, b) {
                            "navigator-y-axis" !== a.options.id && (a.backgroundPane && a.backgroundPane.destroy(), a.backgroundPane = g.rect(a.left, a.top,
                                f, a.height).attr({
                                fill: "#fff",
                                zIndex: 0
                            }).add())
                        });
                        c = this.scroller;
                        d = c.yAxis.height;
                        c.rightCustomLine && c.rightCustomLine.destroy();
                        c.rightCustomLine = g.path(["M", c.scrollerLeft + c.scrollerWidth - 1, c.top, "L", c.scrollerLeft + c.scrollerWidth - 1, c.top + d]).attr({
                            "stroke-width": 1,
                            stroke: "#b2b1b6",
                            "shape-rendering": "crispEdges"
                        }).add()
                    }
                }
            },
            credits: {
                enabled: !1
            },
            xAxis: {
                minRange: 31536E6
            },
            rangeSelector: {
                buttonTheme: {
                    fill: "#ffffff",
                    stroke: "#cccccc",
                    "stroke-width": 1,
                    states: {
                        hover: {
                            fill: "#99bbdd"
                        }
                    }
                },
                selected: 2,
                buttons: [{
                    type: "month",
                    count: 6,
                    text: "6m"
                }, {
                    type: "year",
                    count: 1,
                    text: "1y"
                }, {
                    type: "year",
                    count: 2,
                    text: "2y"
                }, {
                    type: "year",
                    count: 5,
                    text: "5y"
                }, {
                    type: "all",
                    text: "All"
                }]
            },
            indicators: [{
                id: "AAPL",
                type: "sma",
                params: {
                    period: 14
                },
                styles: {
                    "stroke-width": 1,
                    stroke: "#8ddd54",
                    dashstyle: "solid"
                }
            }, {
                id: "AAPL",
                type: "rsi",
                params: {
                    period: 14,
                    overbought: 70,
                    oversold: 30
                },
                styles: {
                    "stroke-width": 1,
                    stroke: "#6ba583",
                    dashstyle: "solid"
                },
                yAxis: {
                    title: {
                        text: "RSI"
                    }
                }
            }],
            yAxis: {
                opposite: !1,
                title: {
                    text: "DATA SMA EMA"
                },
                labels: {
                    align: "left",
                    x: 2
                }
            },
            tooltip: {
                crosshairs: !1,
                shared: !1,
                enabledIndicators: !0,
                followPointer: !1,
                backgroundColor: "white",
                borderWidth: 0,
                borderRadius: 0,
                shape: "square",
                headerFormat: "{point.key} ",
                pointFormat: ' | <span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b>',
                formatter: function() {
                    var c = this.x,
                        d = this.series,
                        a = "",
                        b, a = a + Highcharts.dateFormat(d.currentDataGrouping ? d.tooltipOptions.dateTimeLabelFormats[d.currentDataGrouping.unitName] : d.tooltipOptions.dateTimeLabelFormats.day, c),
                        a = a + ('| <span style="color:' + d.color + '">' + d.name +
                            "</span>: <b>" + this.y.toFixed(2) + "</b>");
                    d.indicators && $.each(d.indicators, function(d, e) {
                        b = e.xData ? e.xData.indexOf(c) : -1;
                        0 <= b && (a += ' | <span style="color:' + e.graph.stroke + '">' + e.options.type.toUpperCase() + "</span>: <b>" + e.yData[b].toFixed(2) + "</b>")
                    });
                    return a
                },
                positioner: function(c, d, a) {
                    return {
                        x: 70,
                        y: 50
                    }
                }
            },
            annotationsOptions: {
                events: {
                    contextmenu: function(c) {
                        var d = h.width(),
                            a = $("body").width(),
                            b = c.pageY,
                            d = d + c.pageX > a ? a - d : c.pageX;
                        this.options.shape.params ? (r.css({
                                "background-color": this.options.shape.params.stroke
                            }),
                            q.css({
                                "background-color": this.options.shape.params.fill
                            })) : t.val(this.options.title.text);
                        this.options.title && "" !== this.options.title.text ? (h.find(".without-title").hide(), h.find(".with-title").show()) : (h.find(".without-title").show(), h.find(".with-title").hide());
                        h.css({
                            top: b + "px",
                            left: d + "px"
                        }).show();
                        this.chart.annotationToEdit = this;
                        (b = h.find("input:visible")[0]) && b.focus();
                        c.preventDefault()
                    }
                }
            },
            annotations: [],
            navigator: {
                xAxis: {
                    plotBands: [{
                        color: "#fff",
                        from: -Infinity,
                        to: Infinity
                    }]
                }
            },
            series: [{
                lineWidth: 2,
                cropThreshold: 0,
                id: "AAPL",
                name: "AAPL",
                data: [],
                tooltip: {
                    valueDecimals: 2
                },
                dataGrouping: {
                    groupPixelWidth: 40
                },
                allowPointSelect: !0,
                marker: {
                    enabled: !0,
                    radius: .1,
                    states: {
                        select: {
                            enabled: !0,
                            radius: 5
                        }
                    }
                },
                point: {
                    events: {
                        select: function() {
                            for (var c = this.x, d = this.series.currentDataGrouping, a = d && 864E5 < d.totalRange ? c + d.totalRange - 1 : c, d = $("#chart-details").highcharts(), b = this.series.xData, e = b.length, h = [], g = 0, f = [], k; g < e; g++) b[g] >= c && (b[g] <= a ? (k = this.series.yData[g], f.push(k), h.push([b[g], k])) : g = e);
                            d.pointToSelect = {
                                x: this.x
                            };
                            c = .9 * Math.min.apply(null, f);
                            f = 1.1 * Math.max.apply(null, f);
                            d.series[0].update({
                                data: h
                            }, !1);
                            d.yAxis[0].setExtremes(c, f);
                            this.series.chart.selectedXPoint = this.x
                        }
                    }
                }
            }]
        },
        k = window.localStorage.getItem("data");
    k ? (k = JSON.parse(k), e.series[0].data = k.data, e.annotations = k.annotations, e.indicators = k.indicators, $("#chart").highcharts("StockChart", $.extend(!0, {}, e))) : $.getJSON("http://www.highcharts.com/samples/data/jsonp.php?filename=aapl-ohlcv.json&callback=?", function(c) {
        e.series[0].data = c;
        $("#chart").highcharts("StockChart",
            $.extend(!0, {}, e))
    })
});